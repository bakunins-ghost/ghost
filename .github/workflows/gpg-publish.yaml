name: Publish GPG Public Key

on:
  # Trigger this manually or upon changes to the key file in the repo
  push:
    paths:
      - 'keys/ancom.space.gpg.pub'
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up SSH for Deployment
      uses: webfactory/ssh-agent@v0.9.0
      with:
        # Use GitHub Secrets to securely store your SSH key for the VPS
        ssh-private-key: ${{ secrets.VPS_SSH_KEY }}

    - name: Deploy Public Key to VPS
      run: |
        # Replace 'ghost@82.29.197.239' with your actual user/IP
        REMOTE_HOST="ghost@82.29.197.239"
        REMOTE_PATH="/home/ghost/.gnupg/private-keys-v1.d/C91FB17EF5ACA74B43AEE683B657BF2E4FDDC52E.key/.well-known/openpgpkey/hu/"

        # Ensure the remote directory exists
        ssh $REMOTE_HOST "mkdir -p $REMOTE_PATH"

        # Securely copy the key file using SCP
        scp -r keys/ancom.space.gpg.pub $REMOTE_HOST:$REMOTE_PATH

      env:
        # Set this to prevent interactive SSH questions
        SSH_ASKPASS: /bin/false